/*
 * main.c
 *
 *  Created on: Sep 13, 2025
 *      Author: Anis
 */


#include "main.h"

/* Peripheral handles */
ADC_HandleTypeDef hadc1;
TIM_HandleTypeDef htim2;
TIM_HandleTypeDef htim4;
UART_HandleTypeDef huart2;


/*Redirect printf to UART2 */
int _write(int file, char *ptr, int len)
{
	HAL_UART_Transmit(&huart2, (uint8_t*)ptr, len, HAL_MAX_DELAY);
	return len;
}

int main(void)
{
	HAL_Init();

	/*Peripheral Init */
	MX_GPIO_Init();
    MX_ADC1_Init();
    MX_TIM2_Init();
    MX_TIM4_Init();
    MX_USART2_UART_Init();

    /* Start Peripherals */
    HAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_1);
    HAL_TIM_Encoder_Start(&htim2, TIM_CHANNEL_ALL);

    while(1)
    {
    	/* Example: Read throttle ADC */
    	HAL_ADC_Start(&hadc1);
    	if(HAL_ADC_PollForConversion(&hadc1, 10) == HAL_OK)
    	{
    		uint16_t throttle = HAL_ADC_GetValue(&hadc1);
    		printf("Throttle ADC: %u\r\n", throttle);
    	}
    	HAL_Delay(100);
    }
}


void Error_Handler(void)
{
    //__disable_irq();
    while (1);
}
